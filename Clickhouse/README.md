Необходимо:

* Поддерживать сырые логи событий (схема выше). Обратите внимание на то, что данные в этой таблице должны хранится 30 дней.

* Построить агрегированную таблицу. Храним агрегаты 180 дней, чтобы делать трендовый анализ:
уникальные пользователи по event_type и event_date
сумма потраченных баллов
количество действий

* Сделать Materialized View, которая:
при вставке данных в таблицу сырых логов событий, будет обновлять агрегированную таблицу
использует sumState, uniqState, countState

* Retention: сколько пользователей вернулись в течение следующих 7 дней. 

* Создать запрос с группировками по быстрой аналитике по дням